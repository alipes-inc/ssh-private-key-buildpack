#!/usr/bin/env bash

function indent() {
	c='s/^/       /'
	case $(uname) in
		Darwin) sed -l "$c";;
		*)      sed -u "$c";;
	esac
}

env_dir=$3
key_file="$env_dir/DEPLOYMENT_SSH_KEY"
private_repo_host=$(cat "$env_dir/PRIVATE_REPO_HOST")
echo "Key path: $key_file"

if [ -f "$key_file" ]; then
	echo "-----> Running SSH private key setup"
	echo "       Private repo host: $private_repo_host"
	mkdir -p "$HOME/.ssh"
	#chmod 777 "$HOME/.ssh"
	cat "$key_file" | base64 --decode > "$HOME/.ssh/id_rsa"
	#cp "$key_file" "$HOME/.ssh/id_rsa"
	#chmod 600 $HOME/.ssh/id_rsa
	exit 0
else
	echo "-----> No SSH private key"
fi
